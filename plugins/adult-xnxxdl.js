import fetch from 'node-fetch';
import cheerio from 'cheerio';
const handler = async (m, {conn, args, command, usedPrefix}) => {
let porn = 'https://qu.ax/bXMB.webp'
let porn2 = 'https://qu.ax/TxtQ.webp'
if (!db.data.chats[m.chat].modohorny && m.isGroup) return conn.sendFile(m.chat, [porn, porn2].getRandom(), 'sticker.webp', '', m, true, { contextInfo: { 'forwardingScore': 200, 'isForwarded': false, externalAdReply:{ showAdAttribution: false, title: `á´¸áµ’Ë¢ á¶œáµ’áµáµƒâ¿áµˆáµ’ Ê°áµ’Ê³â¿Ê¸ áµ‰Ë¢áµ—áµƒ áµˆáµ‰Ë¢áµƒá¶œáµ—á¶¦áµ›áµƒáµˆáµ’ Ë¢á¶¦ áµ‰Ê³áµ‰Ë¢ áµƒáµˆáµá¶¦â¿ Ê¸ áµ áµ˜á¶¦áµ‰Ê³áµ‰ áµƒá¶œáµ—á¶¦áµ›áµƒÊ³Ë¡áµ’Ë¢ áµ˜Ë¢áµƒÊ³:`, body: '#enable modohorny', mediaType: 2, sourceUrl: md, thumbnail: imagen3}}}, { quoted: m, ephemeralExpiration: 24*60*100, disappearingMessagesInChat: 24*60*100})   
  if (!args[0]) throw `*âš ï¸ Â¿Que esta buscando pajin? ingresa un enlace valido de xnxx*\n\n*Aqui te recomiendo uno ejemplo:* ${usedPrefix + command} https://www.xnxx.com/video-14lcwbe8/rubia_novia_follada_en_cuarto_de_bano*`;
  try {
m.react(`âŒ›`) 
    let xnxxLink = '';
    if (args[0].includes('xnxx')) {
      xnxxLink = args[0];
    } else {
      const index = parseInt(args[0]) - 1;
      if (index >= 0) {
        if (Array.isArray(global.videoListXXX) && global.videoListXXX.length > 0) {
          const matchingItem = global.videoListXXX.find((item) => item.from === m.sender);
          if (matchingItem) {
            if (index < matchingItem.urls.length) {
              xnxxLink = matchingItem.urls[index];
            } else {
              throw `*[â—] ğ™½ğ™¾ ğš‚ğ™´ ğ™´ğ™½ğ™²ğ™¾ğ™½ğšƒğšğ™¾ ğš„ğ™½ ğ™´ğ™½ğ™»ğ™°ğ™²ğ™´ ğ™¿ğ™°ğšğ™° ğ™´ğš‚ğ™´ ğ™½ğš„ğ™¼ğ™´ğšğ™¾, ğ™¿ğ™¾ğš ğ™µğ™°ğš…ğ™¾ğš ğ™¸ğ™½ğ™¶ğšğ™´ğš‚ğ™´ ğš„ğ™½ ğ™½ğš„ğ™¼ğ™´ğšğ™¾ ğ™´ğ™½ğšƒğšğ™´ ğ™´ğ™» 1 ğšˆ ğ™´ğ™» ${matchingItem.urls.length}*`;
            }
          } else {
            throw `*[â—] ğ™¿ğ™°ğšğ™° ğ™¿ğ™¾ğ™³ğ™´ğš ğš„ğš‚ğ™°ğš ğ™´ğš‚ğšƒğ™´ ğ™²ğ™¾ğ™¼ğ™°ğ™½ğ™³ğ™¾ ğ™³ğ™´ ğ™´ğš‚ğšƒğ™° ğ™µğ™¾ğšğ™¼ğ™° (${usedPrefix + command} <numero>), ğ™¿ğ™¾ğš ğ™µğ™°ğš…ğ™¾ğš ğšğ™´ğ™°ğ™»ğ™¸ğš‰ğ™° ğ™»ğ™° ğ™±ğš„ğš‚ğš€ğš„ğ™´ğ™³ğ™° ğ™³ğ™´ ğš…ğ™¸ğ™³ğ™´ğ™¾ğš‚ ğ™²ğ™¾ğ™½ ğ™´ğ™» ğ™²ğ™¾ğ™¼ğ™°ğ™½ğ™³ğ™¾ ${usedPrefix}xnxxsearch <texto>*`;
          }
        } else {
          throw `*[â—] ğ™¿ğ™°ğšğ™° ğ™¿ğ™¾ğ™³ğ™´ğš ğš„ğš‚ğ™°ğš ğ™´ğš‚ğšƒğ™´ ğ™²ğ™¾ğ™¼ğ™°ğ™½ğ™³ğ™¾ ğ™³ğ™´ ğ™´ğš‚ğšƒğ™° ğ™µğ™¾ğšğ™¼ğ™° (${usedPrefix + command} <numero>), ğ™¿ğ™¾ğš ğ™µğ™°ğš…ğ™¾ğš ğšğ™´ğ™°ğ™»ğ™¸ğš‰ğ™° ğ™»ğ™° ğ™±ğš„ğš‚ğš€ğš„ğ™´ğ™³ğ™° ğ™³ğ™´ ğš…ğ™¸ğ™³ğ™´ğ™¾ğš‚ ğ™²ğ™¾ğ™½ ğ™´ğ™» ğ™²ğ™¾ğ™¼ğ™°ğ™½ğ™³ğ™¾ ${usedPrefix}xnxxsearch <texto>*`;
        }
      }
    }
    const res = await xnxxdl(xnxxLink);
    const json = await res.result.files;
    conn.sendMessage(m.chat, {document: {url: json.high}, mimetype: 'video/mp4', fileName: res.result.title}, {quoted: m});
m.react(`ğŸ”¥`) 
  } catch {
    throw '*âš ï¸ Â¿Que esta buscando pajin? ingresa un enlace valido de xnxx*\n\n*Aqui te recomiendo uno algo similar a estos:* https://www.xnxx.com/video-14lcwbe8/rubia_novia_follada_en_cuarto_de_bano';
  }
};
handler.help = ['xnxxdl']
handler.tags = ['nsfw'];
handler.command = /^(xnxxdl)$/i;
handler.limit = 12
handler.register = true
export default handler;

async function xnxxdl(URL) {
  return new Promise((resolve, reject) => {
    fetch(`${URL}`, {method: 'get'}).then((res) => res.text()).then((res) => {
      const $ = cheerio.load(res, {xmlMode: false});
      const title = $('meta[property="og:title"]').attr('content');
      const duration = $('meta[property="og:duration"]').attr('content');
      const image = $('meta[property="og:image"]').attr('content');
      const videoType = $('meta[property="og:video:type"]').attr('content');
      const videoWidth = $('meta[property="og:video:width"]').attr('content');
      const videoHeight = $('meta[property="og:video:height"]').attr('content');
      const info = $('span.metadata').text();
      const videoScript = $('#video-player-bg > script:nth-child(6)').html();
      const files = {
        low: (videoScript.match('html5player.setVideoUrlLow\\(\'(.*?)\'\\);') || [])[1],
        high: videoScript.match('html5player.setVideoUrlHigh\\(\'(.*?)\'\\);' || [])[1],
        HLS: videoScript.match('html5player.setVideoHLS\\(\'(.*?)\'\\);' || [])[1],
        thumb: videoScript.match('html5player.setThumbUrl\\(\'(.*?)\'\\);' || [])[1],
        thumb69: videoScript.match('html5player.setThumbUrl169\\(\'(.*?)\'\\);' || [])[1],
        thumbSlide: videoScript.match('html5player.setThumbSlide\\(\'(.*?)\'\\);' || [])[1],
        thumbSlideBig: videoScript.match('html5player.setThumbSlideBig\\(\'(.*?)\'\\);' || [])[1]};
      resolve({status: 200, result: {title, URL, duration, image, videoType, videoWidth, videoHeight, info, files}});
    }).catch((err) => reject({code: 503, status: false, result: err}));
  });
}
